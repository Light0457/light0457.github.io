<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>修正git中错误的提交者姓名 | Light&#39;s space</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="情景在一个仓库上提交时，用户名和邮箱给配置错了，看记录才知道。这可不能接受，看着可不舒服。幸好github帮助页（此帮助页有相对应的中文版本）上有提供这种情况下的方法。帮助页有下面的警告，对于公有仓库最好不去干这种改记录的事。不过我这是私有仓库就无所谓了。
Warning: This action is destructive to your repository&amp;apos;s history.">
<meta property="og:type" content="article">
<meta property="og:title" content="修正git中错误的提交者姓名">
<meta property="og:url" content="http://light0457.github.io/2016/08/13/git/GitChangeCommiterName/index.html">
<meta property="og:site_name" content="Light's space">
<meta property="og:description" content="情景在一个仓库上提交时，用户名和邮箱给配置错了，看记录才知道。这可不能接受，看着可不舒服。幸好github帮助页（此帮助页有相对应的中文版本）上有提供这种情况下的方法。帮助页有下面的警告，对于公有仓库最好不去干这种改记录的事。不过我这是私有仓库就无所谓了。
Warning: This action is destructive to your repository&amp;apos;s history.">
<meta property="og:updated_time" content="2016-08-13T00:29:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="修正git中错误的提交者姓名">
<meta name="twitter:description" content="情景在一个仓库上提交时，用户名和邮箱给配置错了，看记录才知道。这可不能接受，看着可不舒服。幸好github帮助页（此帮助页有相对应的中文版本）上有提供这种情况下的方法。帮助页有下面的警告，对于公有仓库最好不去干这种改记录的事。不过我这是私有仓库就无所谓了。
Warning: This action is destructive to your repository&amp;apos;s history.">
  
    <link rel="alternative" href="/atom.xml" title="Light&#39;s space" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/light_avatar_joke.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">KIRA·Light</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/Shadowsocks/" style="font-size: 10px;">Shadowsocks</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/plist/" style="font-size: 10px;">plist</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">KIRA·Light</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/light_avatar_joke.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">KIRA·Light</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-git/GitChangeCommiterName" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/13/git/GitChangeCommiterName/" class="article-date">
  	<time datetime="2016-08-13T00:29:04.000Z" itemprop="datePublished">2016-08-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      修正git中错误的提交者姓名
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="情景"><a href="#情景" class="headerlink" title="情景"></a>情景</h1><p>在一个仓库上提交时，用户名和邮箱给配置错了，看记录才知道。这可不能接受，看着可不舒服。幸好<a href="https://help.github.com/articles/changing-author-info/" target="_blank" rel="external">github帮助页</a>（此帮助页有<a href="http://dangzhiqiang.blog.51cto.com/7961271/1657864" target="_blank" rel="external">相对应的中文版本</a>）上有提供这种情况下的方法。<br>帮助页有下面的警告，对于公有仓库最好不去干这种改记录的事。不过我这是私有仓库就无所谓了。</p>
<pre><code>Warning: This action is destructive to your repository&apos;s history. If you&apos;re collaborating on a repository with others, it&apos;s considered bad practice to rewrite published history. You should only do this in an emergency.
</code></pre><a id="more"></a>
<h1 id="开始重写历史"><a href="#开始重写历史" class="headerlink" title="开始重写历史"></a>开始重写历史</h1><ol>
<li><p>按帮助页上所写，需要先clone一个<strong>裸版本库</strong>(<a href="https://segmentfault.com/q/1010000004683286" target="_blank" rel="external">bare repository</a>)。查不到官方对裸版本库的说明或者定义，从搜索到的其它资料看，裸版本库就是一个只带历史信息文件的库，库的工作目录和文件并不会存在于目录中，只存在于历史中。远端共享的版本库经常就是裸版本库（可能是因为没检出工作目录省了空间？）。裸版本库还有其它方面未知的，后面找时间再探讨探讨。对于现在来说，我要修改历史信息的私人仓库来说完全是没这必要特意克隆一个裸版本库出来。不过为了试验修改完历史记录后，其它的fork或者clone是什么样合并这个历史记录的，还是跟着clone一个裸版本库出来好了。</p>
<pre><code>git clone --bare https://github.com/user/repo.git
</code></pre></li>
<li><p>帮助页里面提供了一个shell脚本用来批量修改历史记录。如下：</p>
<pre><code>#!/bin/sh

git filter-branch --env-filter &apos;
OLD_EMAIL=&quot;your-old-email@example.com&quot;
CORRECT_NAME=&quot;Your Correct Name&quot;
CORRECT_EMAIL=&quot;your-correct-email@example.com&quot;
if [ &quot;$GIT_COMMITTER_EMAIL&quot; = &quot;$OLD_EMAIL&quot; ]
then
    export GIT_COMMITTER_NAME=&quot;$CORRECT_NAME&quot;
    export GIT_COMMITTER_EMAIL=&quot;$CORRECT_EMAIL&quot;
fi
if [ &quot;$GIT_AUTHOR_EMAIL&quot; = &quot;$OLD_EMAIL&quot; ]
then
    export GIT_AUTHOR_NAME=&quot;$CORRECT_NAME&quot;
    export GIT_AUTHOR_EMAIL=&quot;$CORRECT_EMAIL&quot;
fi
&apos; --tag-name-filter cat -- --branches --tags
</code></pre><p> 其中filter-branch这个命令在pro-git一书中可是把它标为核弹级选项，同时也在那书中看到了相类似的需要修改提交者姓名的需求和做法。至于两者的具体差异，后面可以找时间再研究下。</p>
</li>
<li><p>修改完后推送上去。到于后面的参数以及为何要加<strong>‘refs/heads/*’</strong>这个，等后面有时间再看看吧。</p>
<pre><code>git push --force --tags origin &apos;refs/heads/*&apos;
</code></pre></li>
<li><p>强推时，如果远端分支受保护的话是强推不了的，会遇到下面的错误：</p>
<pre><code>You are not allowed to force push code to a protected branch on this project.
</code></pre><p> gitlab上默认是设置master分支是不允许强推的,需要到Project -&gt; Protected Branches -&gt; 把master分支点掉</p>
</li>
<li><p>让其它人拉取。帮助页在前面时有这么段话：  </p>
<pre><code>Note: Running this script rewrites history for all repository collaborators. After completing these steps, any person with forks or clones must fetch the rewritten history and rebase any local changes into the rewritten history.
</code></pre><p> 也就是其它已经Clone过这仓库的人拉取时要用rebase的方式（即将他们本地的修改历史逐个应用到这个新的历史树上）。否则的话，使用merge的方式将会将他们本地的历史记录（那个包含了错误名字的历史记录）重新合并到分支的历史中，并且又把那些错误名字的提交也合并了过来！！！<br> 所以其它人拉取时，要切记使用   </p>
<pre><code>git pull --rebase &lt;remote name&gt; &lt;branch name&gt;
</code></pre><p> 来拉取。</p>
</li>
</ol>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/13/ShadowsocksAutoGrabber/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          科学上网便捷小工具
        
      </div>
    </a>
  
  
    <a href="/2016/08/13/ssh/SSHNote/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">SSH使用杂记</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="git/GitChangeCommiterName" data-title="修正git中错误的提交者姓名" data-url="http://light0457.github.io/2016/08/13/git/GitChangeCommiterName/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 KIRA·Light
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>